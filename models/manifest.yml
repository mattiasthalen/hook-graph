concepts:
- name: item
  description: Menu items sold at the restaurant (e.g., maki, nigiri), referenced by line items.

- name: order
  description: A customer bill/visit; parent for one or more order line items.

- name: customer
  description: People placing orders; enriched by demographics and marketing.

- name: waiter
  description: Front-of-house staff serving orders.


keysets:
- name: sushi:item:id
  concept: item
  source_system: sushi
  description: Native item identifier from items.

- name: sushi:order:id:ds
  concept: order
  source_system: sushi
  description: Native order identifier from orders, id resets every day.

- name: sushi:customer:id
  concept: customer
  source_system: sushi
  description: Native customer identifier used across orders/demographics/marketing.

- name: sushi:waiter:id
  concept: waiter
  source_system: sushi
  description: Native waiter identifier from orders/waiter_names.

frames:
- name: items
  source_table: raw.items
  grain: [id, ds]
  description: Item catalog with names and prices; referenced by order_items.
  hooks:
  - name: hook__item
    concept: item
    keyset: sushi:item:id:ds
    business_key_field: concat_ws('|', id::TEXT, ds::TEXT)

- name: orders
  source_table: raw.orders
  grain: [id, ds]
  description: Orders with timing and server identifiers; parent to order_items and linked to customers.
  hooks:
  - name: hook__order
    concept: order
    keyset: sushi:order:id:ds
    business_key_field: concat_ws('|', id::TEXT, ds::TEXT)

  - name: hook__customer
    concept: customer
    keyset: sushi:customer:id
    business_key_field: customer_id

  - name: hook__waiter
    concept: waiter
    keyset: sushi:waiter:id
    business_key_field: waiter_id

- name: order_items
  source_table: raw.order_items
  grain: [id, ds]
  description: Line items per order, linking orders to items with quantities.
  hooks:
  - name: hook__order
    concept: order
    keyset: sushi:order:id:ds
    business_key_field: concat_ws('|', order_id::TEXT, ds::TEXT)

  - name: hook__item
    concept: item
    keyset: sushi:item:id:ds
    business_key_field: concat_ws('|', item_id::TEXT, ds::TEXT)

- name: waiter_names
  source_table: raw.waiter_names
  grain: [id]
  description: Lookup of waiter identifiers to staff names.
  hooks:
  - name: hook__waiter
    concept: waiter
    keyset: sushi:waiter:id
    business_key_field: id

- name: demographics
  source_table: raw.demographics
  grain: [id, customer_id]
  description: Customer demographics (e.g., ZIP/region) for enrichment.
  hooks:
  - name: hook__customer
    concept: customer
    keyset: sushi:customer:id
    business_key_field: customer_id

- name: marketing
  source_table: raw.marketing
  grain: [id, customer_id]
  description: Customer marketing attributes (e.g., subscription/status) for segmentation.
  hooks:
  - name: hook__customer
    concept: customer
    keyset: sushi:customer:id
    business_key_field: customer_id